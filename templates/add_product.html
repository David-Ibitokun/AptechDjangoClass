{% extends 'base.html' %}
{% load static %}

{% block title %}Add New Product{% endblock %}

{% block content %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<div class="container py-4">
    <div class="card shadow">
        <div class="card-header bg-warning text-dark fw-bold">Add New Product</div>
        <form method="post" enctype="multipart/form-data" class="p-4">
            {% csrf_token %}

            <div class="row mb-3">
                <div class="col-md-6">
                    {{ form.name.label_tag }}
                    {{ form.name }}
                </div>
                <div class="col-md-6">
                    {# CHANGE THIS LINE: from form.brand to form.brand_name #}
                    {{ form.brand_name.label_tag }}
                    {{ form.brand_name }}
                </div>
            </div>

            <div class="mb-3">
                {{ form.description.label_tag }}
                {{ form.description }}
            </div>

            <div class="row mb-3">
                <div class="col-md-6">
                    {{ form.price.label_tag }}
                    {{ form.price }}
                </div>
                <div class="col-md-6">
                    {{ form.discount_price.label_tag }}
                    {{ form.discount_price }}
                </div>
            </div>

            <div class="mb-3">
                {{ form.tags.label_tag }}
                {{ form.tags }}
                <small class="form-text text-muted">Separate tags with commas.</small>
            </div>

            <div class="mb-3">
                {{ form.image.label_tag }}
                {{ form.image }}
            </div>

            <div class="row mb-3">
                <div class="col-md-6">
                    {# CHANGE THIS LINE: from form.stock to form.stock_quantity #}
                    {{ form.stock_quantity.label_tag }}
                    {{ form.stock_quantity }}
                </div>
                <div class="col-md-6 d-flex align-items-center">
                    {# Assuming form.is_available is a CheckboxInput #}
                    {{ form.is_available }} &nbsp;
                    <label class="form-check-label" for="{{ form.is_available.id_for_label }}">Is available</label>
                </div>
            </div>

            {# ... rest of your template ... #}

            <div class="mb-4 border rounded p-3 bg-light">
                <h6 class="mb-3 fw-bold text-uppercase">Categories</h6>

                <div class="accordion" id="categoryAccordion">
                    {# This part should be fine as it dynamically creates based on your context #}
                    {% for parent in top_level_categories %}
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="heading-{{ parent.slug }}">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                        data-bs-target="#collapse-{{ parent.slug }}" aria-expanded="false"
                                        aria-controls="collapse-{{ parent.slug }}">
                                    {{ parent.name }}
                                </button>
                            </h2>
                            <div id="collapse-{{ parent.slug }}"
                                 class="accordion-collapse collapse {% if selected_category and selected_category.parent == parent %}show{% endif %}"
                                 aria-labelledby="heading-{{ parent.slug }}"
                                 data-bs-parent="#categoryAccordion">
                                <div class="accordion-body ps-4">
                                    {% for subcat in parent.subcategories.all %}
                                        <div class="form-check">
                                            <input class="form-check-input"
                                                   type="radio"
                                                   name="category" {# This name 'category' corresponds to form.category.widget.name #}
                                                   id="subcat-{{ subcat.id }}"
                                                   value="{{ subcat.id }}"
                                                   {% if selected_category and selected_category.id == subcat.id %}checked{% endif %}>
                                            <label class="form-check-label" for="subcat-{{ subcat.id }}">{{ subcat.name }}</label>
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>

            <div class="d-flex justify-content-end gap-2">
                <button type="submit" class="btn btn-success">Add Product</button>
                <a href="{% url 'vendor_dashboard' %}" class="btn btn-secondary">Cancel</a>
            </div>
        </form>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}